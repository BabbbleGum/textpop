ʕ⌐■ᴥ■ʔ: # CleanScript Technical Implementation Plan

## 1. Project Structure

### 📁 Folder Organization

```
cleanscript/
├── app/                    # Next.js app router
│   ├── (auth)/             # Authentication routes
│   │   ├── login/
│   │   ├── signup/
│   │   └── reset-password/
│   ├── api/                # API routes
│   ├── convert/            # Conversion flow pages
│   │   ├── upload/
│   │   ├── processing/
│   │   └── results/
│   ├── dashboard/          # User dashboard
│   ├── globals.css         # Global styles
│   ├── layout.tsx          # Root layout
│   └── page.tsx            # Landing page
├── components/             # Reusable components
│   ├── ui/                 # shadcn/ui components
│   ├── forms/              # Form components
│   ├── layout/             # Layout components
│   └── conversion/         # Conversion-specific components
├── lib/                    # Utility functions
│   ├── supabase/           # Supabase client
│   ├── converters/         # Text conversion logic
│   └── validators/         # Input validation
├── types/                  # TypeScript types
├── public/                 # Static assets
└── middleware.ts           # Auth middleware
```

### 🗂️ Key Files

- `app/layout.tsx` - Main layout with providers
- `app/page.tsx` - Landing page
- `app/convert/upload/page.tsx` - File upload page
- `app/convert/processing/page.tsx` - Processing screen
- `app/convert/results/page.tsx` - Results display
- `components/conversion/FileUploader.tsx` - Drag & drop component
- `components/conversion/TextPreview.tsx` - Output preview
- `lib/converters/vttToText.ts` - Core conversion logic
- `lib/supabase/client.ts` - Supabase initialization
- `middleware.ts` - Auth protection

### 🧩 Component Hierarchy

```
└── RootLayout
    ├── AuthProvider
    │   └── PageLayout
    │       ├── Header
    │       │   ├── Logo
    │       │   ├── Navigation
    │       │   └── AuthButtons
    │       ├── [Page Content]
    │       └── Footer
    └── ToastProvider
```

**Conversion Flow Components:**
```
└── ConversionLayout
    ├── ProgressIndicator
    ├── UploadScreen
    │   ├── FileUploader
    │   └── FormatGuide
    ├── ProcessingScreen
    │   ├── ProgressAnimation
    │   └── StatusMessage
    └── ResultsScreen
        ├── SuccessMessage
        ├── TextPreview
        └── ActionButtons
```

## 2. Data Model

### 📊 Supabase Tables

#### **`users`**
- `id` (UUID, PK) - Auto-generated by Supabase Auth
- `email` (String) - User's email
- `created_at` (Timestamp) - Account creation time
- `updated_at` (Timestamp) - Last update time
- `is_premium` (Boolean) - Premium status flag

#### **`conversions`**
- `id` (UUID, PK) - Unique conversion ID
- `user_id` (UUID, FK) - Reference to users.id
- `created_at` (Timestamp) - When conversion started
- `status` (String) - 'pending', 'processing', 'completed', 'failed'
- `original_filename` (String) - Uploaded file name
- `file_size_kb` (Integer) - Original file size
- `result_size_kb` (Integer) - Result file size
- `processing_time_ms` (Integer) - How long conversion took

#### **`conversion_results`**
- `id` (UUID, PK) - Unique result ID
- `conversion_id` (UUID, FK) - Reference to conversions.id
- `cleaned_text` (Text) - Processed text content
- `original_text` (Text) - Pre-processed content
- `created_at` (Timestamp) - When result was generated

#### **`user_settings`**
- `user_id` (UUID, PK, FK) - Reference to users.id
- `theme` (String) - UI theme preference
- `default_format` (String) - Preferred output format
- `max_file_size_kb` (Integer) - Based on plan limits
- `updated_at` (Timestamp) - Last settings update

### 🔄 Table Relationships

1. `users` 1:N `conversions` - One user can have many conversions
2. `conversions` 1:1 `conversion_results` - Each conversion has one result
3. `users` 1:1 `user_settings` - Each user has one settings record

### 🔐 Storage Buckets

- `conversion_files` - For temporary file storage during processing
  - Structure: `{user_id}/{conversion_id}/original.{ext}`
  - Structure: `{user_id}/{conversion_id}/result.txt`

## 3. Authentication Requirements

### 👥 User Types

1. **Anonymous User**
   - Can view landing page
   - Can perform basic conversions (with limitations)
   - Cannot save history

2. **Free Registered User**
   - Can perform conversions (with limits)
   - Can view conversion history
   - Limited to smaller file sizes (5MB)
   - Max 10 conversions per month

3. **Premium User**
   - Unlimited conversions
   - Larger file support (20MB)
   - Advanced cleaning options
   - Priority processing

### 📋 Permission Levels

| Action | Anonymous | Free | Premium |
|--------|:---------:|:----:|:-------:|
| Basic conversion | ✓ | ✓ | ✓ |
| Save history | ✗ | ✓ | ✓ |
| Download results | ✓ | ✓ | ✓ |
| Multiple file formats | ✗ | ✓ | ✓ |
| Advanced options | ✗ | ✗ | ✓ |
| API access | ✗ | ✗ | ✓ |

### 🔑 Auth Flow

1. **Sign-up Flow:**
   - Email/password registration
   - Optional Google/GitHub OAuth
   - Email verification
   - Welcome onboarding

2. **Login Flow:**
   - Email/password or social login
   - JWT-based session management
   - Remember me option

3. **Session Management:**
   - JWT stored in cookies
   - Session timeout: 2 weeks
   - Refresh token mechanism

4. **Password Reset:**
   - Email-based reset flow
   - Secure time-limited tokens
   - Confirmation email after reset

## 4. Implementation Sequence

### 🥇 Phase 1: Core Conversion (Weeks 1-2)
- Set up Next.js project structure
- Create basic UI components
- Implement VTT to text conversion logic
- Build file upload & processing screens
- Set up error handling

**Dependencies:** None  
**Testing:** Unit tests for converter logic

### 🥈 Phase 2: User System (Weeks 3-4)
- Set up Supabase tables
- Implement authentication flows
- Create user dashboard
- Add conversion history
- Implement basic settings

**Dependencies:** Core conversion  
**Testing:** Auth flow testing, DB integration tests

### 🥉 Phase 3: Enhanced Features (Weeks 5-6)
- Implement premium features
- Add advanced cleaning options
- Create user settings page
- Build conversion management
- Add file format validation

**Dependencies:** User system  
**Testing:** E2E tests with Cypress

### 🏆 Phase 4: Polish & Optimization (Weeks 7-8)
- Performance optimization
- Mobile responsiveness
- Accessibility improvements
- Error recovery mechanisms
- Analytics integration

**Dependencies:** Enhanced features  
**Testing:** Performance testing, accessibility audits

### 🧪 Testing Approach

**Unit Tests:**
- Converter functions
- UI components
- Validation logic

**Integration Tests:**
- Auth flows
- Database operations
- API endpoints

**E2E Tests:**
- Complete conversion flow
- User registration
- Error scenarios

**Accessibility Testing:**
- Screen reader compatibility
- Keyboard navigation
- Color contrast compliance

---

## 🛠️ Technical Decisions & Rationale

### Why Next.js App Router?
- Server components reduce client-side JS
- Simplified routing for ADHD-friendly development
- Built-in API routes for backend functionality

### Why Supabase?
- Built-in auth simplifies implementation
- Real-time subscriptions for processing status
- Storage buckets for temporary files
- Row-level security for data protection

### Why TypeScript?
- Catch errors during development
- Self-documenting code
- Better IDE support for easier development

### Why shadcn/ui?
- Accessible components out of the box
- Consistent with design specifications
- Customizable with Tailwind